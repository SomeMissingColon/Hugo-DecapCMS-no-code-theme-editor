{{ define "main" }}
{{ $hero := .Site.Data.theme.hero }}
{{ $bg := $hero.background }}
<section class="hero" 
         data-bg-type="{{ $bg.type | default "gradient" }}"
         {{- if eq $bg.type "image" }} data-bg-image="{{ $bg.image.src }}"{{ end }}
         {{- if eq $bg.type "video" }} data-bg-video="{{ $bg.video.src }}"{{ end }}>
    {{/* Video Background */}}
    {{ if eq $bg.type "video" }}
    {{ if $bg.video.src }}
    <div class="hero-video">
        <video autoplay{{ if $bg.video.loop }} loop{{ end }} muted playsinline preload="auto"
               {{ if $bg.video.poster }}poster="{{ $bg.video.poster }}"{{ end }}
               webkit-playsinline="true" x5-playsinline="true">
            <source src="{{ $bg.video.src }}" type="video/mp4">
            {{/* Fallback to poster image if video fails */}}
            {{ if $bg.video.poster }}
            <img src="{{ $bg.video.poster }}" alt="Hero background">
            {{ else }}
            <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); width: 100%; height: 100%;"></div>
            {{ end }}
        </video>
    </div>
    {{ end }}
    {{ end }}
    
    {{/* Background Overlay */}}
    {{ if or (eq $bg.type "image") (eq $bg.type "video") }}
    {{ if or $bg.image.overlay $bg.video.overlay }}
    <div class="hero-overlay" style="opacity: {{ if eq $bg.type "image" }}{{ $bg.image.overlay_opacity | default 0.5 }}{{ else }}{{ $bg.video.overlay_opacity | default 0.6 }}{{ end }};"></div>
    {{ end }}
    {{ end }}
    
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                {{ $hero.title | default "Welcome to Your Website" }}
            </h1>
            {{ if $hero.subtitle }}
            <h2 class="hero-subtitle">
                {{ $hero.subtitle }}
            </h2>
            {{ end }}
            {{ if $hero.description }}
            <div class="hero-description">
                {{ $hero.description | markdownify }}
            </div>
            {{ end }}
            <div class="hero-buttons">
                {{ if $hero.primary_button.text }}
                <a href="{{ $hero.primary_button.url | default "/" }}" 
                   class="btn btn-{{ $hero.primary_button.style | default "primary" }}">
                    {{ $hero.primary_button.text }}
                </a>
                {{ end }}
                {{ if $hero.secondary_button.text }}
                <a href="{{ $hero.secondary_button.url | default "/" }}" 
                   class="btn btn-{{ $hero.secondary_button.style | default "secondary" }}">
                    {{ $hero.secondary_button.text }}
                </a>
                {{ end }}
            </div>
        </div>
    </div>
</section>
{{/* End of hero section */}}

{{ if .Site.Data.theme.features.enabled }}
<section class="features">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">{{ .Site.Data.theme.features.title | default "Features" }}</h2>
            {{ if .Site.Data.theme.features.subtitle }}
            <p class="section-subtitle">{{ .Site.Data.theme.features.subtitle }}</p>
            {{ end }}
        </div>
        <div class="features-grid">
            {{ range .Site.Data.theme.features.items }}
            <div class="feature-item">
                <div class="feature-icon">{{ .icon }}</div>
                <h3 class="feature-title">{{ .title }}</h3>
                <p class="feature-description">{{ .description }}</p>
                {{ if .link.text }}
                <a href="{{ .link.url }}" class="feature-link">{{ .link.text }} â†’</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}

{{ if .Site.Data.theme.about.enabled }}
<section class="about">
    <div class="container">
        <div class="about-content">
            <div class="about-text">
                <h2 class="section-title">{{ .Site.Data.theme.about.title | default "About Us" }}</h2>
                <div class="about-description">
                    {{ .Site.Data.theme.about.content | markdownify }}
                </div>
                {{ if .Site.Data.theme.about.cta.text }}
                <a href="{{ .Site.Data.theme.about.cta.url | default "/about/" }}" class="btn btn-primary">
                    {{ .Site.Data.theme.about.cta.text }}
                </a>
                {{ end }}
            </div>
            {{ if .Site.Data.theme.about.image }}
            <div class="about-image">
                <img src="{{ .Site.Data.theme.about.image }}" alt="{{ .Site.Data.theme.about.title }}">
            </div>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}

{{ if .Site.Data.theme.testimonials.enabled }}
<section class="testimonials">
    <div class="container">
        <h2 class="section-title">{{ .Site.Data.theme.testimonials.title | default "What Our Clients Say" }}</h2>
        <div class="testimonials-grid">
            {{ range .Site.Data.theme.testimonials.items }}
            <div class="testimonial-item">
                <blockquote class="testimonial-quote">
                    "{{ .quote }}"
                </blockquote>
                <div class="testimonial-author">
                    {{ if .photo }}
                    <img src="{{ .photo }}" alt="{{ .name }}" class="testimonial-photo">
                    {{ end }}
                    <div class="testimonial-info">
                        <strong class="testimonial-name">{{ .name }}</strong>
                        {{ if .title }}
                        <span class="testimonial-title">{{ .title }}</span>
                        {{ end }}
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}

{{ if .Site.Data.theme.cta_section.enabled }}
<section class="cta-section cta-{{ .Site.Data.theme.cta_section.background | default "primary" }}">
    <div class="container">
        <div class="cta-content">
            <h2 class="cta-title">{{ .Site.Data.theme.cta_section.title | default "Ready to Get Started?" }}</h2>
            {{ if .Site.Data.theme.cta_section.subtitle }}
            <p class="cta-subtitle">{{ .Site.Data.theme.cta_section.subtitle }}</p>
            {{ end }}
            <div class="cta-buttons">
                {{ if .Site.Data.theme.cta_section.primary_button.text }}
                <a href="{{ .Site.Data.theme.cta_section.primary_button.url | default "/contact/" }}" class="btn btn-primary">
                    {{ .Site.Data.theme.cta_section.primary_button.text }}
                </a>
                {{ end }}
                {{ if .Site.Data.theme.cta_section.secondary_button.text }}
                <a href="{{ .Site.Data.theme.cta_section.secondary_button.url | default "/about/" }}" class="btn btn-secondary">
                    {{ .Site.Data.theme.cta_section.secondary_button.text }}
                </a>
                {{ end }}
            </div>
        </div>
    </div>
</section>
{{ end }}

<section class="content">
    <div class="container">
        {{ .Content }}
    </div>
</section>
{{ end }}